# Eventide Agent Event Protocol

The Eventide gateway relies on a standard event protocol to capture and stream the progression of an AI agent's execution. This protocol is highly inspired by and compatible with open web agent standards like the [AG-UI Protocol](https://ag-ui.com/), while ensuring that the underlying data streams seamlessly into our backend and frontend infrastructure.

## Event Envelope (JSON Schema)

Every event sent to the Eventide gateway has a standard outer envelope.

```json
{
  "spec_version": "agent-events/1.0",
  "event_id": "01J00000000000000000000000",
  "thread_id": "thread_abc123",
  "turn_id": "turn_def456",
  "seq": 10,
  "ts": "2026-02-20T10:00:00Z",
  "type": "turn.started",
  "level": "info",
  "payload": {},
  "content_type": "application/json",
  "source": {},
  "trace": {},
  "tags": {}
}
```

- **`spec_version`**: The protocol specification version (default: `agent-events/1.0`).
- **`event_id`**: Unique ULID for the event. (Auto-generated by gateway if omitted).
- **`thread_id`**: The ID of the conversation thread or continuous session.
- **`turn_id`**: The ID of the current agent interaction or action cycle.
- **`seq`**: Sequence number to guarantee correct ordering of events within a thread. (Auto-assigned by gateway if omitted).
- **`ts`**: Event timestamp in ISO-8601 UTC format. (Auto-generated by gateway if omitted).
- **`type`**: The specific event type (see details below).
- **`level`**: Log level severity (`debug`, `info`, `warn`, `error`).
- **`payload`**: The core data, structurally dependent on the event `type`.
- **`content_type`**, **`source`**, **`trace`**, **`tags`**: Optional metadata fields for tracing and filtering.

---

## Event Taxonomy

We define **13 events** in 5 main categories to represent the full lifecycle of an autonomous agent interaction.

### 1. Lifecycle Events
Indicate the start and status of high-level agent execution logic.

| Event Type | Equivalent (AG-UI) | Description |
|---|---|---|
| `turn.started` | `RUN_STARTED` | Emitted when a new agent execution turn starts. The `payload` typically contains the `input` argument that initiated the turn. |
| `turn.completed` | `RUN_FINISHED`| Emitted when the agent finishes the turn successfully. The `payload` typically contains the final output or a `{ "ok": true }` status. |
| `turn.failed` | `RUN_ERROR` | Emitted when the agent crashes or returns an error. The `payload` should contain `{ "error": "description..." }`. |
| `turn.cancelled` | — | Emitted if the turn execution was aborted externally before completion. |

### 2. Message Streaming Events
Used to stream textual or interactive chunks back to the user interface in real-time.

| Event Type | Equivalent (AG-UI) | Description |
|---|---|---|
| `message.delta` | `TEXT_MESSAGE_CONTENT` | A chunk of streamed text. Payload: `{ "message_id": "msg1", "delta": "hello " }` |
| `message.completed` | `TEXT_MESSAGE_END` | Signals the end of a message stream. Payload: `{ "message_id": "msg1" }` |

### 3. Tool Calling Events
Captures when the agent uses external tools or function calls, enabling high observability.

| Event Type | Equivalent (AG-UI) | Description |
|---|---|---|
| `tool.call.started` | `TOOL_CALL_START` | Agent decides to invoke a tool. Payload: `{ "tool": "search_db" }` |
| `tool.call.args.delta` | `TOOL_CALL_ARGS` | Streaming arguments (JSON chunks) if the LLM generates arguments iteratively. |
| `tool.call.completed` | `TOOL_CALL_END` | The tool execution finishes. Payload: `{ "tool": "search_db", "result": "..." }` |
| `tool.call.error` | — | Emitted if the tool execution fails. |

### 4. State Management Events
For sharing or incrementally persisting agent/graph state data over time.

| Event Type | Equivalent (AG-UI) | Description |
|---|---|---|
| `state.snapshot` | `STATE_SNAPSHOT` | A full snapshot of the agent's internal state dictionary at a given point in time. |
| `state.delta` | `STATE_DELTA` | A partial update (often using JSON Patch syntax) to incrementally update the frontend state. |

### 5. Custom / Infrastructure Events

| Event Type | Equivalent (AG-UI) | Description |
|---|---|---|
| `custom` | `CUSTOM` | Emitted for application-specific occurrences. Payload completely defined by user. |
| `thread.ready` | — | Indicates that a new thread container/virtual machine is fully provisioned and ready for work. |

---

## Framework Interoperability

Our event schema makes it simple to map from popular open-source frameworks. 

### LangGraph (`astream_events`)

```python
async for event in graph.astream_events(inputs, version="v2"):
    kind = event["event"]
    if kind == "on_chain_start":
        # -> Emit "turn.started"
    elif kind == "on_chat_model_stream":
        # -> Emit "message.delta"
    elif kind == "on_tool_start":
        # -> Emit "tool.call.started"
    elif kind == "on_tool_end":
        # -> Emit "tool.call.completed"
```

### CrewAI Callbacks

In CrewAI, callbacks on Steps, Tasks, or Crews map cleanly to our `Lifecycle` and `Tool` events:
- `TaskStartedEvent` -> `turn.started`
- `TaskCompletedEvent` -> `turn.completed`
- `ToolUsageStartedEvent` -> `tool.call.started`

---

## Client SDKs

We provide first-party SDKs to make event ingestion effortless:
- **Go**: `github.com/warjiang/eventide/sdk/go/eventide`
- **Python**: `pip install eventide` (from `sdk/python`)
- **Node.js**: `npm install @eventide/sdk` (from `sdk/nodejs`)

By default, the Gateway exposes HTTP ingest APIs (`POST /events:append`), and the Beacon service exposes Server-Sent Events (`GET /threads/{thread_id}/events/stream`) allowing realtime consumption via standard `EventSource` in the browser.
